==================================================
Emacsの使い方
==================================================

エディタはプログラミングを楽にするための道具です。
自分に合ったものを選ぶのが一番です。
その参考になるように、Emacsの簡単な使い方と、
便利なパッケージなどを紹介しておこうと思います。

Emacsの学習コスト
==================================================

はじめに学習コストに関して思うところを書いてみます。

Emacsを快適に操作をするためにある程度キーバインドを覚えないといけなかったり、
カスタマイズしようと思うとElispの知識が必要だったり、
と学習コストは高め（決して安くはない）です。

プログラミングの統合開発環境には ``Eclipse`` や ``Xcode`` 、
文書作成には ``Word`` だったり、
TeXの統合環境には ``EasyTeX`` や ``TeXShop`` などがあります。
これらはそれぞれの用途に特化していて、便利になるように設計されているのですが、
結局、各ソフト毎の操作を覚えなくてはいけないため、
実は学習コストは同じくらいなんじゃないかなとも思います。


インストール
==================================================

MacOS Xにインストールする場合、
`Emacs For MacOSX <http://emacsformacosx.com>`__
から既にビルドされたものを取ってくるのが一番です。



基本操作
==================================================

操作方法を羅列するのは無意味なので、
よく使う操作について ``Emacs`` 、``vim`` 、そして ``less`` を比較してみました。


ページ移動
--------------------------------------------------

.. list-table:: ページ移動
   :header-rows: 1

   * - 操作内容
     - Emacs
     - Vim
     - less
   * - 次の行へ移動
     - :kbd:`C-n`
     - :kbd:`j` , :kbd:`RET`
     - :kbd:`j` , :kbd:`RET`
   * - 前の行へ移動
     - :kbd:`C-p`
     - :kbd:`k`
     - :kbd:`k`
   * - １ページ進む
     - :kbd:`C-v`
     - :kbd:`C-f`
     - :kbd:`SPC`
   * - １ページ戻る
     - :kbd:`M-v`
     - :kbd:`C-b`
     - :kbd:`S-SPC`
   * - ファイルの先頭へ移動
     - :kbd:`M-<`
     - :kbd:`gg`
     - :kbd:`g`
   * - ファイルの最後へ移動
     - :kbd:`M->`
     - :kbd:`G`
     - :kbd:`G`
   * - 指定した行へジャンプ
     - :kbd:`M-g g 数値`
     - :kbd:`数値 G`
     - :kbd:`:数値`
   * - 半ページ進む
     -
     -
     - :kbd:`d`
   * - 半ページ戻る
     -
     -
     - :kbd:`u`
   * - ファイルを閉じる
     - :kbd:`C-x C-c`
     - :kbd:`:q` ,  :kbd:`:q!`
     - :kbd:`q`



カーソル移動
--------------------------------------------------

.. list-table:: カーソル移動
   :header-rows: 1

   * - 操作内容
     - Emacs
     - Vim
   * - 次の文字へ移動
     - :kbd:`C-f`
     - :kbd:`l` , :kbd:`SPC`
   * - 前の文字へ移動
     - :kbd:`C-b`
     - :kbd:`h`
   * - 次の単語へ移動
     - :kbd:`M-f`
     - :kbd:`w` , :kbd:`e`
   * - 前の単語へ移動
     - :kbd:`M-b`
     - :kbd:`b`
   * - 行頭へ移動
     - :kbd:`C-a`
     - :kbd:`0`
   * - 文頭（行頭にある文字）へ移動
     -
     - :kbd:`^`
   * - 行末へ移動
     - :kbd:`C-e`
     - :kbd:`$`
   * - タブ（インデント？）
     - :kbd:`C-i`
     -
   * - 画面内の移動（上−中−下）
     - :kbd:`C-l`
     -


-  Emacsの場合、
   `jawordパッケージ <https://github.com/zk-phi/jaword>`__
   を導入すると日本語の単語移動が賢くなります。


切り貼り
--------------------------------------------------


+-----------+----------------------------+----------------------------------------+
| Emacs     | vim                        | 操作内容                               |
+===========+============================+========================================+
| ``C-k``   | ``d$``                     | カーソルの位置から行末までを切り取り   |
+-----------+----------------------------+----------------------------------------+
| ``C-w``   | ``d$`` , ``dd`` , ``dw``   | 選択範囲を切り取り                     |
+-----------+----------------------------+----------------------------------------+
|           | ``dd``                     | 一行削除（切り取り）                   |
+-----------+----------------------------+----------------------------------------+
|           | ``dw``                     | １単語を切り取り                       |
+-----------+----------------------------+----------------------------------------+
|           | ``d$`` , ``d^`` , ``d0``   | それぞれ切り取り                       |
+-----------+----------------------------+----------------------------------------+
| ``M-w``   | ``y``                      | 選択範囲をコピー（yank）               |
+-----------+----------------------------+----------------------------------------+
|           | ``yy``                     | 一行コピー（yank）                     |
+-----------+----------------------------+----------------------------------------+
|           | ``yw``                     | １単語をコピー（yank）                 |
+-----------+----------------------------+----------------------------------------+
|           | ``y$`` , ``y^`` , ``y0``   | それぞれコピー（yank）                 |
+-----------+----------------------------+----------------------------------------+
| ``C-y``   | ``p``                      | 貼り付け                               |
+-----------+----------------------------+----------------------------------------+

検索
--------------------------------------------------

+-----------+-------------------------------+--------------------------------------------------+
| Emacs     | vim                           | 操作内容                                         |
+===========+===============================+==================================================+
| ``C-s``   | ``/文字`` , ``n`` , ``C-i``   | 前方検索                                         |
+-----------+-------------------------------+--------------------------------------------------+
| ``C-r``   | ``?文字`` , ``N`` , ``C-o``   | 後方検索                                         |
+-----------+-------------------------------+--------------------------------------------------+
| ``C-@``   | ``v``                         | マーカーのセット                                 |
+-----------+-------------------------------+--------------------------------------------------+
| ``M-%``   | ``:s/old/new``                | 現在行の最初の文字を置換（old -> new）           |
+-----------+-------------------------------+--------------------------------------------------+
|           | ``:s/old/new/g``              | 現在行のすべての文字を置換（old -> new）         |
+-----------+-------------------------------+--------------------------------------------------+
|           | ``:%s/old/new/gc``            | ファイル全体のすべての文字を、確認しながら置換   |
+-----------+-------------------------------+--------------------------------------------------+

-  Emacsの場合、
   `cmigemo <https://github.com/koron/cmigemo>`__ と
   `migemoパッケージ <https://github.com/emacs-jp/migemo>`__
   を導入するとローマ字で日本語検索が可能になります。
-  インストールと設定の詳細は
   `るびきち「日刊Emacs」 <http://rubikitch.com/2014/08/20/migemo/>`__
   を参考にするとよいと思います。



ファイル操作
--------------------------------------------------

+--------------------------+---------------------+-----------------------------------------+
| Emacs                    | vim                 | 操作内容                                |
+==========================+=====================+=========================================+
| ``C-x C-s``              | ``:w``              | ファイルを保存                          |
+--------------------------+---------------------+-----------------------------------------+
| ``C-x C-w ファイル名``   | ``:w ファイル名``   | ファイル名を指定して保存                |
+--------------------------+---------------------+-----------------------------------------+
| ``C-x C-i ファイル名``   | ``:r ファイル名``   | ファイル名の中身を挿入                  |
+--------------------------+---------------------+-----------------------------------------+
| ``C-d``                  | ``x``               | カーソルの下の文字を削除（Delete）      |
+--------------------------+---------------------+-----------------------------------------+
| ``C-h``                  | ``Backspace``       | カーソルの左の文字を削除（Backspace）   |
+--------------------------+---------------------+-----------------------------------------+

-  デフォルトだと ``C-h`` はヘルプですが、
   ``Backspace`` に置き換えています。



エディタ特有
--------------------------------------------------

+-----------------------+-----------------+------------------------------------------------+
| Emacs                 | vim             | 操作内容                                       |
+=======================+=================+================================================+
|                       | ``ESC``         | ノーマルモードへ切替                           |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``i``           | カーソルの位置に追加                           |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``a``           | カーソルの次の位置に追加                       |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``A``           | 行末に追加                                     |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``I``           | 行頭に追加                                     |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``o``           | カーソルの下の行に追加                         |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``O``           | カーソルの上の行に追加                         |
+-----------------------+-----------------+------------------------------------------------+
| ``C-j``               |                 | 改行                                           |
+-----------------------+-----------------+------------------------------------------------+
| ``C-o``               |                 | 改行                                           |
+-----------------------+-----------------+------------------------------------------------+
| ``C-m``               |                 | 改行                                           |
+-----------------------+-----------------+------------------------------------------------+
| ``RET``               |                 | 改行                                           |
+-----------------------+-----------------+------------------------------------------------+
| ``C-x u`` , ``C-/``   | ``u``           | 直前の動作の取り消し                           |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``U``           | 行全体の変更の取り消し                         |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``C-r``         | 取り消しの取り消し                             |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``r``           | カーソル下の１文字の置換                       |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``R``           | カーソル下の複数文字の置換                     |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``cw``          | カーソル位置の単語の変更（削除＋挿入）         |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``c$``          | カーソル位置から行末までの変更（削除＋挿入）   |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``c0``          | カーソル位置から行頭までの変更（削除＋挿入）   |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``c^``          | カーソル位置から文頭までの変更（削除＋挿入）   |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``C-g``         | ファイル内の位置の表示                         |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``%``           | 対応するカッコへ移動                           |
+-----------------------+-----------------+------------------------------------------------+
|                       | ``!コマンド``   | 外部コマンドを実行                             |
+-----------------------+-----------------+------------------------------------------------+



キーボード設定
--------------------------------------------------

Emacsを快適に操作するためには、少しだけキーボード設定をした方が良いと思います。
あんまり変えすぎちゃうと、他のPCを使うときやPCを買い替えた時の
再設定がめんどくさくなるので、ほどほどに。

私の場合は以下の３点を変更しています。

+----------------------------+--------------------------------+--------------------------------+
|                            | 変更前                         | 変更後                         |
+============================+================================+================================+
| Controlキーの追加          | ``CapsLock``                   | ``Control``                    |
+----------------------------+--------------------------------+--------------------------------+
| Spotlight検索              | ``Control + Space``            | ``Option + Command + Space``   |
+----------------------------+--------------------------------+--------------------------------+
| Select next input source   | ``Option + Command + Space``   | OFF                            |
+----------------------------+--------------------------------+--------------------------------+



キーボード設定変更のスクリーンショット
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

-  ``CapsLock`` を ``Control`` に変更

|image0|

-  スポットライト検索のショートカットキーを変更する前。デフォルトは
   ``Control + Space``

|image1|

-  スポットライト検索のショートカットキーを ``Option + Command + Space``
   に変更。重複するキーがあるため黄色い警告がでている

|image2|

-  ``Select next source in input menu``
   なんてショートカットキーはこれまで使ったことない。なので無効にしても問題ないはず

|image3|

.. |image0| image:: ./fig/mac-keyboard04.png
.. |image1| image:: ./fig/mac-keyboard01.png
.. |image2| image:: ./fig/mac-keyboard02.png
.. |image3| image:: ./fig/mac-keyboard03.png


パッケージ管理
--------------------------------------------------

Emacs24からパッケージ管理システムがデフォルトで使えるようになりました。
その設定だけは必ずしておくと良いと思うので、以下に書いておきます。デフォルトのELPAリポジトリはパッケージの登録数が少ないらしいので、MELPAリポジトリを追加しておきます。さらにはMarmaladeリポジトリというのもあります。


.. code-block:: elisp

   (require 'package)
   (add-to-list 'package-archives
                '("melpa" . "http://melpa.org/packages/") t)
   (package-initialize)


.. include:: emacs-prelude.rst
.. include:: emacs-org.rst
.. include:: emacs-yatex.rst
.. include:: emacs-magit.rst
.. include:: emacs-twitter.rst
.. include:: emacs-vim.rst
