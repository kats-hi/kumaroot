* Sphinxの使い方

  このドキュメントを生成しているSphinxの使い方についてのメモです。

** ワークフロー

   1. Orgモードで文章を作成（ただし、QuickLookできるように.txt形式で保存）
   2. pandocを使って、reST形式に変換
   3. Sphinxを使って、HTML と PDFに変換

** pandocコマンドの使い方

   OrgのreSTエクスポート（ox-rst）が、うまくいかないので、pandocを使って変換している。

#+begin_src bash
$ cd $KUMAROOT
$ pandoc -f org -t rst source/FILENAME.txt -o source/FILENAME.rst
#+end_src

   おためしワンライナー。これをMakefileに書いておけばいいのかもしれない。

#+begin_src bash
$ for f in source/*.txt; do pandoc -f org -t rst $f -o "source/`basename $f .txt`.rst"; done
#+end_src


** PDF変換

   PDFの変換には、pdflatex／dvipdfmxを使う。

#+begin_src bash
$ cd $KUMAROOT
$ make latexpdfja
$ open build/latex/KumaROOT.pdf
#+end_src

** HTML変換

#+begin_src bash
$ cd $KUMAROOT
$ make html
$ open build/html/index.html
#+end_src


** conf.pyの設定

   HTMLやPDF変換に必要な設定をしておく。

*** LaTeXドキュメントの設定（ =latex_elements= ）

#+begin_src python
latex_elements = {
    'papersize' = 'a4paper',
    'pointsize' = '12pt',
    'preamble': '',    # あとで追加するので定義だけしておく
    'figure_align': 'htbp',
#   'fontpkg': '\\usepackage{times}',
}
#+end_src

*** プリアンブルの追加（ =latex_elements['preamble']= ）

    上の =latex_elements= の中で複数のパッケージを書くと見た目がカッコ悪いので、
    以下のように =latex_elements['preamble']= に直接追加することにした。

#+begin_src python
latex_elements['preamble'] += '\\usepackage{pxjahyper}\n'
latex_elements['preamble'] += '\\usepackage{graphics}\n'
#+end_src


*** LaTeXのドキュメントクラスの設定（ =latex_docclass= ）

    =latex_documents= はデフォルトのままにしておき、
    =latex_docclass= を変更する。

#+begin_src python
latex_docclass = {'manual' : 'jsbook'}
#+end_src


*** LaTeXの表紙の設定（ =latex_logo= ）

    表紙に挿入する絵の設定。
    必要ないなら =None= （デフォルト値）にしておけばよい。

#+begin_src python
# The name of an image file (relative to this directory)
# to place at the top of the title page.
latex_logo = './images/toumin_kuma.png'
#+end_src


*** HTMLテーマの設定

    まず、 =pip= を使って =sphinx_bootstrap_theme= をインストールする。
    登録されているパッケージ名は =sphinx-bootstrap-theme= （ハイフンでつないである）という、
    ちょっとしたトラップがある（そのうち直るのかな？）

    インストール時にエラーが出たので、エラーメッセージに従って、 =sudo -H= を使って実行した。

#+begin_src python
$ sudo -H pip install sphinx-bootstrap-theme
#+end_src

    [[https://ryan-roemer.github.io/sphinx-bootstrap-theme/README.html#installation][Installation]] の通りに、
    =html_theme= 、 =html_theme_path= を設定する。

#+begin_src python
import sphinx_bootstrap_theme
html_theme = 'bootstrap'
html_theme_path = sphinx_bootstrap_theme.get_html_theme_path()
#+end_src

    =html_theme_options= は
    [[https://ryan-roemer.github.io/sphinx-bootstrap-theme/README.html#theme-options][Theme options]] をとりあえずコピペして、
    いろいろテストしてみる。

#+begin_src python
html_theme_options = {
    # Navigation bar title. (Default: ``project`` value)
    # 'navbar_title': "Demo",

    # Tab name for entire site. (Default: "Site")
    # 'navbar_site_name': "Site",

    # A list of tuples containing pages or urls to link to.
    # Valid tuples should be in the following forms:
    #    (name, page)                 # a link to a page
    #    (name, "/aa/bb", 1)          # a link to an arbitrary relative url
    #    (name, "http://example.com", True) # arbitrary absolute url
    # Note the "1" or "True" value above as the third argument to indicate
    # an arbitrary url.
    # 'navbar_links': [
    #     ("Examples", "examples"),
    #     ("Link", "http://example.com", True),
    # ],

    # Render the next and previous page links in navbar. (Default: true)
    'navbar_sidebarrel': True,

    # Render the current pages TOC in the navbar. (Default: true)
    'navbar_pagenav': True,

    # Tab name for the current pages TOC. (Default: "Page")
    'navbar_pagenav_name': "Page",

    # Global TOC depth for "site" navbar tab. (Default: 1)
    # Switching to -1 shows all levels.
    'globaltoc_depth': 2,

    # Include hidden TOCs in Site navbar?
    #
    # Note: If this is "false", you cannot have mixed ``:hidden:`` and
    # non-hidden ``toctree`` directives in the same page, or else the build
    # will break.
    #
    # Values: "true" (default) or "false"
    'globaltoc_includehidden': "true",

    # HTML navbar class (Default: "navbar") to attach to <div> element.
    # For black navbar, do "navbar navbar-inverse"
    'navbar_class': "navbar navbar-inverse",

    # Fix navigation bar to top of page?
    # Values: "true" (default) or "false"
    'navbar_fixed_top': "true",

    # Location of link to source.
    # Options are "nav" (default), "footer" or anything else to exclude.
    'source_link_position': "nav",

    # Bootswatch (http://bootswatch.com/) theme.
    #
    # Options are nothing (default) or the name of a valid theme
    # such as "amelia" or "cosmo".
    # 'bootswatch_theme': "united",
    # 'bootswatch_theme': "cosmo",

    # Choose Bootstrap version.
    # Values: "3" (default) or "2" (in quotes)
    'bootstrap_version': "3",
}
#+end_src
